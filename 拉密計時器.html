<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>拉密計時器</title>

<!-- 圖示 -->
<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="拉密計時器">

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#240046,#3c096c,#5a189a,#7b2cbf);
    font-family:"Microsoft JhengHei",sans-serif;
    color:white;
}
.app{
    width:95vw;
    max-width:420px;
    height:90vh;
    padding:15px;
    border-radius:25px;
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(20px);
    box-shadow:0 12px 35px rgba(0,0,0,0.35);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    text-align:center;
}
h1{font-size:20px;margin-bottom:12px;}
.settings{font-size:14px;}
select{
    margin-top:5px;
    padding:8px;
    border-radius:8px;
    border:none;
    width:95px;
    text-align:center;
}

/* 倒數區塊 */
.timer-container{
    position: relative;
    cursor: pointer;
    padding: 140px 20px; /* 高度減少，適合手機 */
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background: rgba(255,255,255,0.05);
    border-radius: 20px;
}
.player, .timer{
    pointer-events: none;
}
.player{font-size:24px;}
.timer{
    font-size:90px;
    font-weight:600;
    transition:0.2s;
}
.warning{
    color:#ff3b3b;
    animation: pulse 0.5s infinite;
}
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.25); }
    100% { transform: scale(1); }
}

/* 觸控回饋動畫 */
@keyframes clickFeedback {
    0% { transform: scale(1); }
    50% { transform: scale(0.92); }
    100% { transform: scale(1); }
}
.timer-container.click-feedback {
    animation: clickFeedback 0.15s forwards;
}

.pause-btn{
    padding:10px 25px;
    border-radius:15px;
    border:none;
    background:rgba(255,255,255,0.15);
    color:white;
    font-size:16px;
    margin-top:10px;
}
</style>
</head>
<body>
<div class="app" id="app">
    <div>
        <h1>拉密計時器</h1>
        <div class="settings">
            回合秒數<br>
            <select id="roundSelect"><option value="30">30</option><option value="60" selected>60</option><option value="120">120</option></select>
            <br><br>
            玩家人數<br>
            <select id="playerSelect"><option value="2">2</option><option value="3">3</option><option value="4" selected>4</option><option value="5">5</option><option value="6">6</option></select>
        </div>
    </div>

    <div class="timer-container" id="timerContainer">
        <div class="player" id="playerDisplay">玩家 1</div>
        <div class="timer" id="timerDisplay">60</div>
    </div>

    <button class="pause-btn" id="pauseBtn">暫停</button>
</div>

<script>
let roundTime=60, timeLeft=60, currentPlayer=1, totalPlayers=4;
let timerInterval=null, zeroBeepInterval=null;
let isPaused=false, isZeroState=false;

const timerDisplay=document.getElementById("timerDisplay");
const playerDisplay=document.getElementById("playerDisplay");
const timerContainer=document.getElementById("timerContainer");
const pauseBtn=document.getElementById("pauseBtn");

function applySettings(){
    roundTime=parseInt(document.getElementById("roundSelect").value);
    totalPlayers=parseInt(document.getElementById("playerSelect").value);
    resetAll();
}
document.getElementById("roundSelect").addEventListener("change",applySettings);
document.getElementById("playerSelect").addEventListener("change",applySettings);

function updateDisplay(){
    timerDisplay.textContent=timeLeft;
    playerDisplay.textContent="玩家 "+currentPlayer;

    if(timeLeft<=10 && timerInterval && !isPaused){
        timerDisplay.classList.add("warning");
        beepShort();
    }else{
        timerDisplay.classList.remove("warning");
    }
}

// 點倒數區塊
timerContainer.addEventListener("click", () => {
    timerContainer.classList.add("click-feedback");
    setTimeout(()=>timerContainer.classList.remove("click-feedback"),150);

    playClickBeep();
    if(navigator.vibrate){ navigator.vibrate(50); }

    if(timerInterval && !isPaused && !isZeroState){ 
        nextPlayer();
    } else if(!timerInterval && !isPaused && !isZeroState){
        startTimer();
    } else if(isZeroState){ 
        stopZeroBeep();
        nextPlayer();
    }
});

// 暫停/繼續
pauseBtn.addEventListener("click", () => {
    if(!timerInterval && !isPaused && !isZeroState) return;
    if(isPaused){ // 繼續
        isPaused=false;
        pauseBtn.textContent="暫停";
        if(!isZeroState){
            startTimer();
        } else {
            startZeroBeep();
        }
    }else{ // 暫停
        if(timerInterval){
            clearInterval(timerInterval);
            timerInterval=null;
        }
        if(isZeroState){
            stopZeroBeep();
        }
        isPaused=true;
        pauseBtn.textContent="繼續";
    }
});

function startTimer(){
    if(timerInterval) return;
    timerInterval=setInterval(()=>{
        if(timeLeft>0){
            timeLeft--;
            updateDisplay();
        }else{
            clearInterval(timerInterval);
            timerInterval=null;
            startZeroBeep();
            isZeroState=true;
        }
    },1000);
}

function nextPlayer(){
    clearInterval(timerInterval);
    timerInterval=null;
    isPaused=false;
    pauseBtn.textContent="暫停";
    currentPlayer++; if(currentPlayer>totalPlayers) currentPlayer=1;
    timeLeft=roundTime;
    isZeroState=false;
    updateDisplay();
    startTimer();
}

function startZeroBeep(){
    if(zeroBeepInterval) return;
    zeroBeepInterval=setInterval(()=>{
        const ctx=new (window.AudioContext||window.webkitAudioContext)();
        const osc=ctx.createOscillator();
        osc.type="square";
        osc.frequency.setValueAtTime(600,ctx.currentTime);
        osc.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime+0.2);
    },500);
}
function stopZeroBeep(){clearInterval(zeroBeepInterval); zeroBeepInterval=null;}

function beepShort(){
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const osc=ctx.createOscillator();
    osc.type="sine";
    osc.frequency.setValueAtTime(1000,ctx.currentTime);
    osc.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime+0.08);
}

function playClickBeep(){
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const osc=new OscillatorNode(ctx);
    osc.type="sine";
    osc.frequency.setValueAtTime(180,ctx.currentTime);
    const gain=ctx.createGain();
    gain.gain.setValueAtTime(0.5,ctx.currentTime);
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime+0.15);
}

function resetAll(){
    clearInterval(timerInterval);
    timerInterval=null;
    stopZeroBeep();
    currentPlayer=1;
    timeLeft=roundTime;
    isPaused=false;
    isZeroState=false;
    pauseBtn.textContent="暫停";
    updateDisplay();
}

applySettings();
</script>
</body>
</html>